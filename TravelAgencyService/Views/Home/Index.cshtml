@model TravelAgencyService.Models.ViewModels.HomeViewModel
@{
    ViewData["Title"] = "Travel Agency - Your Journey Begins Here";
}

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

<!-- Hero Section -->
<section class="hero-section position-relative overflow-hidden" style="height: 85vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="position-absolute w-100 h-100" style="background: url('https://images.unsplash.com/photo-1488085061387-422e29b40080?q=80&w=2831') center/cover; opacity: 0.3; animation: parallax 20s ease-in-out infinite;"></div>
    
    <div class="container h-100 position-relative" style="z-index: 10;">
        <div class="row h-100 align-items-center">
            <div class="col-lg-7 text-white">
                <h1 class="display-2 fw-bold mb-4" style="animation: fadeInUp 1s ease; text-shadow: 2px 2px 20px rgba(0,0,0,0.3);">
                    Discover Your Next
                    <span class="d-block" style="background: linear-gradient(45deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Adventure</span>
                </h1>
                <p class="lead fs-4 mb-5" style="animation: fadeInUp 1.2s ease; text-shadow: 1px 1px 10px rgba(0,0,0,0.3);">
                    Explore destinations on our interactive map and find your perfect getaway
                </p>
                
                <div class="d-flex gap-3 flex-wrap" style="animation: fadeInUp 1.4s ease;">
                    <a href="#map-explorer" class="btn btn-light btn-lg px-5 py-3 fw-bold smooth-scroll" style="border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                        <i class="bi bi-map-fill"></i> Explore Map
                    </a>
                    <a href="#featured" class="btn btn-outline-light btn-lg px-5 py-3 fw-bold smooth-scroll" style="border-radius: 50px; border-width: 3px;">
                        <i class="bi bi-star-fill"></i> Popular Deals
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Animated Wave -->
    <div class="wave-bottom">
        <svg viewBox="0 0 1200 120" preserveAspectRatio="none" style="height: 100px; width: 100%; position: absolute; bottom: 0;">
            <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" style="fill: #fff;"></path>
        </svg>
    </div>
</section>

<!-- Statistics Counter -->
<section class="py-5" style="background: linear-gradient(180deg, #fff 0%, #f8f9fa 100%);">
    <div class="container">
        <div class="row text-center g-4">
            <div class="col-md-4">
                <div class="stat-card p-4 h-100" style="animation: countUp 1.5s ease; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                    <div class="stat-icon mb-3" style="font-size: 3.5rem; background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="bi bi-globe2"></i>
                    </div>
                    <h2 class="display-4 fw-bold mb-2 counter" data-target="@Model.TotalTrips" style="color: #667eea;">0</h2>
                    <p class="text-muted fs-6 mb-0 fw-semibold">Amazing Destinations</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card p-4 h-100" style="animation: countUp 1.5s ease 0.2s; animation-fill-mode: both; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                    <div class="stat-icon mb-3" style="font-size: 3.5rem; background: linear-gradient(45deg, #f093fb, #f5576c); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="bi bi-pin-map-fill"></i>
                    </div>
                    <h2 class="display-4 fw-bold mb-2 counter" data-target="@Model.TotalCountries" style="color: #f093fb;">0</h2>
                    <p class="text-muted fs-6 mb-0 fw-semibold">Countries Worldwide</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card p-4 h-100" style="animation: countUp 1.5s ease 0.4s; animation-fill-mode: both; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                    <div class="stat-icon mb-3" style="font-size: 3.5rem; background: linear-gradient(45deg, #4facfe, #00f2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="bi bi-people-fill"></i>
                    </div>
                    <h2 class="display-4 fw-bold mb-2 counter" data-target="@Model.TotalBookings" style="color: #4facfe;">0</h2>
                    <p class="text-muted fs-6 mb-0 fw-semibold">Happy Travelers</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Interactive Map Explorer -->
<section id="map-explorer" class="py-5" style="background: #f8f9fa;">
    <div class="container-fluid px-lg-5">
        <!-- Header -->
        <div class="text-center mb-5">
            <span class="badge px-4 py-2 mb-3" style="background: linear-gradient(45deg, #667eea, #764ba2); font-size: 0.9rem; border-radius: 50px;">
                <i class="bi bi-stars"></i> Interactive Experience
            </span>
            <h2 class="display-5 fw-bold mb-3" style="color: #2d3748;">
                Explore Destinations on Map
            </h2>
            <p class="lead text-muted mb-0">Discover amazing places around the world • Click markers for details</p>
        </div>

        <div class="row g-4">
            <!-- Left Sidebar - Filters -->
            <div class="col-xl-3 col-lg-4">
                <div class="sticky-top" style="top: 20px;">
                    <div class="card border-0 shadow-sm" style="border-radius: 20px; overflow: hidden;">
                        <!-- Header -->
                        <div class="card-header border-0 py-4" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                            <h5 class="mb-0 text-white fw-bold">
                                <i class="bi bi-funnel-fill me-2"></i>Search & Filter
                            </h5>
                        </div>

                        <div class="card-body p-4">
                            <!-- Quick Search -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold small text-uppercase text-muted mb-2">
                                    <i class="bi bi-search me-1"></i>Quick Search
                                </label>
                                <input type="text" id="quickSearch" class="form-control form-control-lg" 
                                       placeholder="Search destinations..." 
                                       style="border-radius: 12px; border: 2px solid #e2e8f0;">
                            </div>

                            <!-- Package Type -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold small text-uppercase text-muted mb-2">
                                    <i class="bi bi-tag-fill me-1"></i>Package Type
                                </label>
                                <select id="mapPackageFilter" class="form-select form-select-lg" style="border-radius: 12px; border: 2px solid #e2e8f0;">
                                    <option value="">🌍 All Types</option>
                                    @foreach (var type in Enum.GetValues<TravelAgencyService.Models.PackageType>())
                                    {
                                        var typeIcons = new Dictionary<string, string> {
                                            { "Family", "👨‍👩‍👧‍👦" }, { "Honeymoon", "💑" }, { "Adventure", "⚡" },
                                            { "Cruise", "🚢" }, { "Luxury", "💎" }, { "Business", "💼" },
                                            { "Budget", "💰" }, { "Solo", "🧳" }, { "Group", "👥" }
                                        };
                                        <option value="@type">@(typeIcons.ContainsKey(type.ToString()) ? typeIcons[type.ToString()] : "✨") @type</option>
                                    }
                                </select>
                            </div>

                            <!-- Price Range -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold small text-uppercase text-muted mb-2">
                                    <i class="bi bi-cash-coin me-1"></i>Price Range
                                </label>
                                <input type="range" id="mapPriceFilter" class="form-range mb-3" min="0" max="10000" step="100" value="10000" 
                                       style="height: 6px; background: linear-gradient(to right, #667eea, #764ba2);">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-light text-dark px-3 py-2">$0</span>
                                    <span class="badge px-3 py-2 fw-bold" style="background: linear-gradient(45deg, #667eea, #764ba2);">
                                        Max: $<span id="priceValue">10000</span>
                                    </span>
                                </div>
                            </div>

                            <!-- Show Options -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold small text-uppercase text-muted mb-3">
                                    <i class="bi bi-eye-fill me-1"></i>Display Options
                                </label>
                                <div class="d-grid gap-2">
                                    <label class="d-flex align-items-center p-3 rounded" style="background: #f7fafc; cursor: pointer; border: 2px solid #e2e8f0;">
                                        <input class="form-check-input me-3" type="checkbox" id="showOnSale" checked style="width: 24px; height: 24px;">
                                        <div>
                                            <div class="fw-semibold">🔥 On Sale</div>
                                            <small class="text-muted">Show discounted trips</small>
                                        </div>
                                    </label>
                                    <label class="d-flex align-items-center p-3 rounded" style="background: #f7fafc; cursor: pointer; border: 2px solid #e2e8f0;">
                                        <input class="form-check-input me-3" type="checkbox" id="showRegular" checked style="width: 24px; height: 24px;">
                                        <div>
                                            <div class="fw-semibold">🌏 Regular</div>
                                            <small class="text-muted">Show regular priced</small>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Results -->
                            <div class="p-3 rounded text-center" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                                <div class="text-white">
                                    <div class="display-6 fw-bold mb-1" id="resultsCount">@Model.AllTrips.Count</div>
                                    <small class="opacity-90">Destinations Found</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Map Controls Help -->
                    <div class="card border-0 shadow-sm mt-3" style="border-radius: 20px;">
                        <div class="card-body p-4">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-info-circle-fill text-primary me-2"></i>Map Controls
                            </h6>
                            <ul class="list-unstyled small mb-0">
                                <li class="mb-2">
                                    <i class="bi bi-mouse2 text-muted me-2"></i><strong>Drag</strong> to move around
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-zoom-in text-muted me-2"></i><strong>Scroll</strong> to zoom in/out
                                </li>
                                <li>
                                    <i class="bi bi-pin-map text-muted me-2"></i><strong>Click markers</strong> for details
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right - Map -->
            <div class="col-xl-9 col-lg-8">
                <!-- Map Card -->
                <div class="card border-0 shadow-lg position-relative" style="border-radius: 20px; overflow: hidden;">
                    <div id="tripMap" style="height: 700px; position: relative;"></div>
                    
                    <!-- Loading Overlay -->
                    <div id="loadingOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(10px);">
                        <div class="text-center">
                            <div class="spinner-border mb-3" style="width: 4rem; height: 4rem; color: #667eea;" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <h5 class="fw-bold" style="color: #667eea;">Loading Destinations</h5>
                            <p class="text-muted">Preparing your adventure map...</p>
                        </div>
                    </div>

                    <!-- Map Stats Badge -->
                    <div class="position-absolute top-0 start-0 m-4" style="z-index: 500;">
                        <div class="badge px-4 py-3 shadow-lg" style="background: rgba(255,255,255,0.95); color: #2d3748; backdrop-filter: blur(10px); border-radius: 15px; font-size: 0.95rem;">
                            <i class="bi bi-geo-alt-fill text-danger me-2"></i>
                            <strong id="visibleMarkers">@Model.AllTrips.Count</strong> locations
                        </div>
                    </div>

                    <!-- Zoom Controls Info -->
                    <div class="position-absolute bottom-0 start-0 m-4" style="z-index: 500;">
                        <div class="badge px-3 py-2" style="background: rgba(0,0,0,0.7); color: white; border-radius: 10px;">
                            <i class="bi bi-info-circle me-1"></i>
                            Use scroll or buttons to zoom
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="row g-3 mt-3">
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm h-100" style="border-radius: 15px; background: linear-gradient(135deg, #667eea, #764ba2);">
                            <div class="card-body text-white text-center p-4">
                                <i class="bi bi-map fs-2 mb-2 opacity-75"></i>
                                <div class="display-6 fw-bold" id="mapVisibleCount">@Model.AllTrips.Count</div>
                                <small class="opacity-90">On Map</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm h-100" style="border-radius: 15px; background: linear-gradient(135deg, #f093fb, #f5576c);">
                            <div class="card-body text-white text-center p-4">
                                <i class="bi bi-lightning-fill fs-2 mb-2 opacity-75"></i>
                                <div class="display-6 fw-bold" id="saleCount">0</div>
                                <small class="opacity-90">On Sale</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm h-100" style="border-radius: 15px; background: linear-gradient(135deg, #4facfe, #00f2fe);">
                            <div class="card-body text-white text-center p-4">
                                <i class="bi bi-cash-coin fs-2 mb-2 opacity-75"></i>
                                <div class="display-6 fw-bold">$<span id="avgPrice">0</span></div>
                                <small class="opacity-90">Avg Price</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Trips -->
<section id="featured" class="py-5 bg-white">
    <div class="container">
        <div class="text-center mb-5">
            <span class="badge px-4 py-2 mb-3" style="background: linear-gradient(45deg, #667eea, #764ba2); font-size: 0.9rem; border-radius: 50px;">
                <i class="bi bi-fire"></i> Most Popular
            </span>
            <h2 class="display-5 fw-bold mb-3" style="color: #2d3748;">
                Top Destinations
            </h2>
            <p class="lead text-muted">Handpicked adventures loved by thousands</p>
        </div>

        @if (Model.FeaturedTrips.Any())
        {
            <div class="row g-4">
                @foreach (var trip in Model.FeaturedTrips)
                {
                    <div class="col-lg-4 col-md-6">
                        <div class="trip-card card h-100 border-0 shadow-lg" style="border-radius: 20px; overflow: hidden; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
                            <div class="position-relative overflow-hidden" style="height: 250px;">
                                @if (!string.IsNullOrEmpty(trip.MainImageUrl))
                                {
                                    <img src="@trip.MainImageUrl" class="card-img-top" alt="@trip.PackageName" style="height: 100%; object-fit: cover; transition: transform 0.5s ease;">
                                }
                                else
                                {
                                    <div class="bg-gradient d-flex align-items-center justify-content-center h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                        <i class="bi bi-image text-white" style="font-size: 4rem; opacity: 0.3;"></i>
                                    </div>
                                }

                                @if (trip.IsOnSale)
                                {
                                    <div class="position-absolute top-0 start-0 m-3">
                                        <span class="badge px-3 py-2 fs-6 fw-bold" style="background: #ff6b6b; border-radius: 12px; animation: pulse 2s infinite;">
                                            <i class="bi bi-lightning-fill"></i> @trip.DiscountPercentage% OFF
                                        </span>
                                    </div>
                                }
                                <div class="position-absolute top-0 end-0 m-3">
                                    <span class="badge bg-dark px-3 py-2" style="border-radius: 12px; backdrop-filter: blur(10px); background: rgba(0,0,0,0.7) !important;">
                                        <i class="bi bi-heart-fill text-danger"></i> @trip.TimesBooked
                                    </span>
                                </div>

                                <div class="position-absolute w-100 h-100 d-flex align-items-center justify-content-center trip-overlay" style="background: rgba(102, 126, 234, 0.95); opacity: 0; transition: opacity 0.3s ease;">
                                    <a asp-controller="Trip" asp-action="Details" asp-route-id="@trip.TripId" class="btn btn-light btn-lg px-5 py-3 fw-bold" style="border-radius: 50px;">
                                        <i class="bi bi-eye-fill"></i> View Details
                                    </a>
                                </div>
                            </div>

                            <div class="card-body p-4">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <span class="badge px-3 py-2" style="background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 12px;">
                                        @trip.PackageType
                                    </span>
                                    <div class="text-end">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <i class="bi bi-star@(i <= trip.AverageRating ? "-fill" : "") text-warning"></i>
                                        }
                                        <small class="text-muted d-block">(@trip.ReviewCount)</small>
                                    </div>
                                </div>

                                <h5 class="card-title fw-bold mb-2">@trip.PackageName</h5>
                                
                                <p class="text-muted mb-3 small">
                                    <i class="bi bi-geo-alt-fill text-danger"></i> @trip.Destination, @trip.Country
                                </p>

                                <div class="d-flex align-items-center gap-2 mb-3">
                                    <span class="badge bg-light text-dark px-3 py-2">
                                        <i class="bi bi-calendar3"></i> @trip.TripDurationDays days
                                    </span>
                                    <span class="badge bg-light text-dark px-3 py-2">
                                        <i class="bi bi-door-open"></i> @trip.AvailableRooms rooms
                                    </span>
                                </div>

                                <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                                    <div>
                                        @if (trip.IsOnSale)
                                        {
                                            <small class="text-muted text-decoration-line-through d-block">$@trip.OriginalPrice</small>
                                            <span class="fs-4 fw-bold text-danger">$@trip.Price</span>
                                        }
                                        else
                                        {
                                            <span class="fs-4 fw-bold text-primary">$@trip.Price</span>
                                        }
                                        <small class="text-muted d-block">/person</small>
                                    </div>
                                    <a asp-controller="Trip" asp-action="Details" asp-route-id="@trip.TripId" class="btn px-4 py-2 fw-bold" style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; border-radius: 12px; border: none;">
                                        Book <i class="bi bi-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <div class="text-center mt-5">
                <a asp-controller="Trip" asp-action="Index" class="btn btn-lg px-5 py-3 fw-bold" style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; border-radius: 50px; box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);">
                    <i class="bi bi-grid-3x3-gap"></i> View All @Model.TotalTrips Destinations
                </a>
            </div>
        }
    </div>
</section>

<!-- Package Types -->
<section class="py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="container">
        <div class="text-center text-white mb-5">
            <h2 class="display-5 fw-bold mb-3">Find Your Style</h2>
            <p class="lead opacity-90">Every adventure deserves the perfect experience</p>
        </div>

        <div class="row g-4 justify-content-center">
            @foreach (var type in Enum.GetValues<TravelAgencyService.Models.PackageType>())
            {
                var icons = new Dictionary<string, string> {
                    { "Family", "people-fill" }, { "Honeymoon", "heart-fill" }, { "Adventure", "lightning-fill" },
                    { "Cruise", "water" }, { "Luxury", "gem" }, { "Business", "briefcase-fill" },
                    { "Budget", "piggy-bank-fill" }, { "Solo", "person-fill" }, { "Group", "people-fill" }
                };
                
                <div class="col-lg-2 col-md-3 col-6">
                    <a asp-controller="Trip" asp-action="Index" asp-route-packageType="@type" class="text-decoration-none">
                        <div class="package-type-card p-4 text-center" style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-radius: 20px; transition: all 0.3s ease; border: 2px solid rgba(255,255,255,0.2);">
                            <i class="bi bi-@(icons.ContainsKey(type.ToString()) ? icons[type.ToString()] : "star-fill") text-white mb-3 d-block" style="font-size: 2.5rem;"></i>
                            <h6 class="text-white fw-bold mb-0">@type</h6>
                        </div>
                    </a>
                </div>
            }
        </div>
    </div>
</section>

<!-- Reviews -->
@if (Model.RecentReviews.Any())
{
    <section class="py-5" style="background: #f8f9fa;">
        <div class="container">
            <div class="text-center mb-5">
                <span class="badge px-4 py-2 mb-3" style="background: linear-gradient(45deg, #667eea, #764ba2); font-size: 0.9rem; border-radius: 50px;">
                    <i class="bi bi-chat-heart-fill"></i> Testimonials
                </span>
                <h2 class="display-5 fw-bold mb-3" style="color: #2d3748;">What Travelers Say</h2>
                <p class="lead text-muted">Real experiences from real adventurers</p>
            </div>

            <div class="row g-4">
                @foreach (var review in Model.RecentReviews)
                {
                    <div class="col-md-4">
                        <div class="review-card card border-0 shadow-lg h-100" style="border-radius: 20px; transition: transform 0.3s ease;">
                            <div class="card-body p-4">
                                <div class="mb-3">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <i class="bi bi-star@(i <= review.Rating ? "-fill" : "") text-warning fs-5"></i>
                                    }
                                </div>

                                @if (!string.IsNullOrEmpty(review.Title))
                                {
                                    <h5 class="fw-bold mb-3">"@review.Title"</h5>
                                }

                                <p class="text-muted mb-4">@review.Comment</p>

                                <div class="d-flex align-items-center border-top pt-3">
                                    <div class="avatar me-3" style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(45deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">
                                        @review.UserName.Substring(0, 1).ToUpper()
                                    </div>
                                    <div>
                                        <div class="fw-bold">@review.UserName</div>
                                        <small class="text-muted">@review.CreatedAt.ToString("MMMM dd, yyyy")</small>
                                        @if (!string.IsNullOrEmpty(review.TripName))
                                        {
                                            <div><small class="text-primary"><i class="bi bi-airplane"></i> @review.TripName</small></div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
}
<!-- What Users Think About Our Service -->
@if (Model.ServiceReviews.Any())
{
    <section class="py-5 bg-white">
        <div class="container">
            <div class="text-center mb-5">
                <span class="badge px-4 py-2 mb-3" style="background: linear-gradient(45deg, #28a745, #20c997); font-size: 0.9rem; border-radius: 50px;">
                    <i class="bi bi-hand-thumbs-up-fill"></i> Service Feedback
                </span>
                <h2 class="display-5 fw-bold mb-3" style="color: #2d3748;">
                    What Users Think About Our Service
                </h2>
                <p class="lead text-muted">Feedback about our booking experience</p>
            </div>

            <div class="row g-4">
                @foreach (var review in Model.ServiceReviews)
                {
                    <div class="col-md-4">
                        <div class="card border-0 shadow-lg h-100" style="border-radius: 20px;">
                            <div class="card-body p-4">
                                <div class="mb-3">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <i class="bi bi-star@(i <= review.Rating ? "-fill" : "") text-warning fs-5"></i>
                                    }
                                </div>

                                @if (!string.IsNullOrEmpty(review.Title))
                                {
                                    <h5 class="fw-bold mb-3">"@review.Title"</h5>
                                }

                                <p class="text-muted mb-4">@review.Comment</p>

                                <div class="d-flex align-items-center border-top pt-3">
                                    <div class="avatar me-3" style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(45deg, #28a745, #20c997); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">
                                        @review.UserName.Substring(0, 1).ToUpper()
                                    </div>
                                    <div>
                                        <div class="fw-bold">@review.UserName</div>
                                        <small class="text-muted">@review.CreatedAt.ToString("MMMM dd, yyyy")</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            @if (User.Identity?.IsAuthenticated == true)
            {
                <div class="text-center mt-4">
                    <a asp-controller="Review" asp-action="Create" class="btn btn-success btn-lg px-5 py-3" style="border-radius: 50px;">
                        <i class="bi bi-pencil-square"></i> Share Your Experience
                    </a>
                </div>
            }
        </div>
    </section>
}
<!-- CTA -->
<section class="py-5 position-relative overflow-hidden" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 400px;">
    <div class="position-absolute w-100 h-100" style="background: url('https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=2674') center/cover; opacity: 0.2;"></div>
    
    <div class="container position-relative text-center text-white py-5" style="z-index: 10;">
        <h2 class="display-4 fw-bold mb-4">Start Your Journey Today</h2>
        <p class="lead fs-4 mb-5 opacity-90">Join thousands discovering the world with us</p>
        
        <div class="d-flex gap-3 justify-content-center flex-wrap">
            @if (User.Identity?.IsAuthenticated == true)
            {
                <a asp-controller="Trip" asp-action="Index" class="btn btn-light btn-lg px-5 py-3 fw-bold" style="border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <i class="bi bi-compass-fill"></i> Explore Now
                </a>
            }
            else
            {
                <a asp-controller="Account" asp-action="Register" class="btn btn-light btn-lg px-5 py-3 fw-bold" style="border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <i class="bi bi-person-plus-fill"></i> Join Free
                </a>
                <a asp-controller="Account" asp-action="Login" class="btn btn-outline-light btn-lg px-5 py-3 fw-bold" style="border-radius: 50px; border-width: 3px;">
                    <i class="bi bi-box-arrow-in-right"></i> Sign In
                </a>
            }
        </div>
    </div>
</section>

<!-- CSS & Animations -->
<style>
    :root {
        --primary: #667eea;
        --secondary: #764ba2;
    }

    @@keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @@keyframes parallax {
        0%, 100% { transform: scale(1) translateY(0); }
        50% { transform: scale(1.05) translateY(-10px); }
    }

    @@keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    @@keyframes countUp {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .smooth-scroll {
        scroll-behavior: smooth;
    }

    .trip-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 25px 60px rgba(102, 126, 234, 0.4) !important;
    }

    .trip-card:hover img {
        transform: scale(1.1);
    }

    .trip-card:hover .trip-overlay {
        opacity: 1;
    }

    .package-type-card:hover {
        background: rgba(255,255,255,0.3) !important;
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }

    .review-card:hover {
        transform: translateY(-8px);
    }

    /* Map Styles */
    .leaflet-popup-content-wrapper {
        border-radius: 16px !important;
        box-shadow: 0 15px 50px rgba(0,0,0,0.2) !important;
        padding: 8px !important;
    }

    .leaflet-popup-tip { display: none; }
    .custom-marker-icon { background: transparent; border: none; }
    .leaflet-marker-icon { animation: markerBounce 0.6s ease; }

    @@keyframes markerBounce {
        0% { transform: translateY(-80px); opacity: 0; }
        60% { transform: translateY(8px); }
        100% { transform: translateY(0); opacity: 1; }
    }

    /* Better zoom controls */
    .leaflet-control-zoom {
        border: none !important;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15) !important;
        border-radius: 12px !important;
        overflow: hidden;
    }

    .leaflet-control-zoom a {
        width: 36px !important;
        height: 36px !important;
        line-height: 36px !important;
        font-size: 20px !important;
        border: none !important;
        background: white !important;
        color: var(--primary) !important;
    }

    .leaflet-control-zoom a:hover {
        background: var(--primary) !important;
        color: white !important;
    }

    /* Smooth scrolling */
    html {
        scroll-behavior: smooth;
    }
</style>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Counter Animation
        const counters = document.querySelectorAll('.counter');
        const animateCounter = (counter) => {
            const target = parseInt(counter.getAttribute('data-target'));
            const duration = 2000;
            const increment = target / (duration / 16);
            let current = 0;
            
            const updateCounter = () => {
                current += increment;
                if (current < target) {
                    counter.textContent = Math.floor(current);
                    requestAnimationFrame(updateCounter);
                } else {
                    counter.textContent = target;
                }
            };
            updateCounter();
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateCounter(entry.target);
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });

        counters.forEach(counter => observer.observe(counter));

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Trip Data
        const tripsData = @Html.Raw(Json.Serialize(Model.AllTrips.Select(t => new {
            id = t.TripId,
            name = t.PackageName,
            destination = t.Destination,
            country = t.Country,
            latitude = t.Latitude,
            longitude = t.Longitude,
            price = t.Price,
            originalPrice = t.OriginalPrice,
            packageType = t.PackageType.ToString(),
            isOnSale = t.IsOnSale,
            availableRooms = t.AvailableRooms,
            rating = t.AverageRating,
            reviewCount = t.ReviewCount,
            imageUrl = t.MainImageUrl,
            discountPercentage = t.DiscountPercentage
        })));

        console.log('📊 Loaded trips:', tripsData.length);

        // Package Colors
        const packageColors = {
            'Family': '#667eea', 'Honeymoon': '#e91e63', 'Adventure': '#ff5722',
            'Cruise': '#00bcd4', 'Luxury': '#ffc107', 'Business': '#607d8b',
            'Budget': '#4caf50', 'Solo': '#9c27b0', 'Group': '#ff9800'
        };

        // Initialize Map
        const map = L.map('tripMap', {
            zoomControl: true,
            scrollWheelZoom: true,
            doubleClickZoom: true,
            touchZoom: true,
            dragging: true,
            minZoom: 2,
            maxZoom: 18
        }).setView([30, 0], 2);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap',
            maxZoom: 18
        }).addTo(map);

        const markers = L.markerClusterGroup({
            maxClusterRadius: 50,
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            zoomToBoundsOnClick: true,
            iconCreateFunction: function(cluster) {
                const count = cluster.getChildCount();
                return L.divIcon({
                    html: `<div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 5px 20px rgba(0,0,0,0.3); border: 3px solid white; font-size: 14px;">${count}</div>`,
                    className: 'custom-cluster-icon',
                    iconSize: L.point(45, 45)
                });
            }
        });

        let allMarkers = [];
        const geocodeCache = {};

        async function geocodeLocation(destination, country) {
            const cacheKey = `${destination}, ${country}`;
            if (geocodeCache[cacheKey]) return geocodeCache[cacheKey];

            try {
                const query = encodeURIComponent(cacheKey);
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=1`);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    const coords = { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
                    geocodeCache[cacheKey] = coords;
                    return coords;
                }
            } catch (error) {
                console.error(`Geocoding failed for ${cacheKey}:`, error);
            }
            return null;
        }

        async function loadMarkers() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            for (const trip of tripsData) {
                let coords = trip.latitude && trip.longitude 
                    ? { lat: trip.latitude, lon: trip.longitude }
                    : await geocodeLocation(trip.destination, trip.country);
                
                if (coords) {
                    const color = packageColors[trip.packageType] || '#667eea';
                    const icon = L.divIcon({
                        html: `
                            <div style="position: relative;">
                                <div style="background: ${color}; width: 42px; height: 42px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 6px 20px rgba(0,0,0,0.35);">
                                    <span style="transform: rotate(45deg); color: white; font-weight: 700; font-size: 11px;">$${Math.round(trip.price)}</span>
                                </div>
                                ${trip.isOnSale ? '<div style="position: absolute; top: -6px; right: -6px; background: #ff6b6b; color: white; border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; box-shadow: 0 3px 10px rgba(0,0,0,0.4); border: 2px solid white;">🔥</div>' : ''}
                            </div>
                        `,
                        className: 'custom-marker-icon',
                        iconSize: [42, 42],
                        iconAnchor: [21, 42]
                    });

                    const marker = L.marker([coords.lat, coords.lon], { icon: icon });
                    marker.bindPopup(`
                        <div style="min-width: 300px; max-width: 320px;">
                            ${trip.imageUrl ? `<img src="${trip.imageUrl}" style="width: 100%; height: 160px; object-fit: cover; border-radius: 12px; margin-bottom: 12px;">` : ''}
                            <h6 style="font-weight: 700; margin-bottom: 10px; color: ${color}; font-size: 16px;">${trip.name}</h6>
                            <p style="margin: 8px 0; color: #666; font-size: 14px;">
                                <i class="bi bi-geo-alt-fill" style="color: #e74c3c;"></i> ${trip.destination}, ${trip.country}
                            </p>
                            <div style="margin: 12px 0;">
                                <span style="background: ${color}; color: white; padding: 6px 14px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                    ${trip.packageType}
                                </span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 12px; border-top: 2px solid #eee;">
                                <div>
                                    ${trip.isOnSale ? `
                                        <small style="text-decoration: line-through; color: #999; display: block; font-size: 12px;">$${trip.originalPrice}</small>
                                        <span style="font-size: 26px; font-weight: 700; color: #e74c3c;">$${trip.price}</span>
                                    ` : `
                                        <span style="font-size: 26px; font-weight: 700; color: ${color};">$${trip.price}</span>
                                    `}
                                    <small style="display: block; color: #999; font-size: 12px;">/person</small>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: #ffc107; font-size: 15px; margin-bottom: 4px;">
                                        ${'★'.repeat(Math.round(trip.rating))}${'☆'.repeat(5 - Math.round(trip.rating))}
                                    </div>
                                    <small style="color: #999; font-size: 11px;">(${trip.reviewCount} reviews)</small>
                                </div>
                            </div>
                            <div style="margin-top: 12px; padding: 8px; background: ${trip.availableRooms <= 3 ? '#fee' : '#efe'}; border-radius: 8px;">
                                <small style="color: ${trip.availableRooms <= 3 ? '#e74c3c' : '#27ae60'}; font-weight: 600; font-size: 12px;">
                                    <i class="bi bi-door-open"></i> ${trip.availableRooms} rooms available
                                </small>
                            </div>
                            <a href="/Trip/Details/${trip.id}" style="display: block; text-align: center; background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 12px; border-radius: 12px; text-decoration: none; font-weight: 700; margin-top: 14px; font-size: 14px;">
                                View Details & Book <i class="bi bi-arrow-right"></i>
                            </a>
                        </div>
                    `, { maxWidth: 340, className: 'custom-popup' });

                    marker.tripData = trip;
                    allMarkers.push(marker);
                    markers.addLayer(marker);
                }
            }

            map.addLayer(markers);
            document.getElementById('loadingOverlay').style.display = 'none';

            if (allMarkers.length > 0) {
                const group = new L.featureGroup(allMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
            }

            updateStats();
        }

        function updateStats() {
            const visibleCount = markers.getLayers().length;
            const saleCount = markers.getLayers().filter(m => m.tripData.isOnSale).length;
            const avgPrice = markers.getLayers().reduce((sum, m) => sum + m.tripData.price, 0) / (visibleCount || 1);
            
            document.getElementById('visibleMarkers').textContent = visibleCount;
            document.getElementById('mapVisibleCount').textContent = visibleCount;
            document.getElementById('resultsCount').textContent = visibleCount;
            document.getElementById('saleCount').textContent = saleCount;
            document.getElementById('avgPrice').textContent = Math.round(avgPrice);
        }

        function filterMarkers() {
            const selectedType = document.getElementById('mapPackageFilter').value;
            const maxPrice = parseInt(document.getElementById('mapPriceFilter').value);
            const showOnSale = document.getElementById('showOnSale').checked;
            const showRegular = document.getElementById('showRegular').checked;
            const searchQuery = document.getElementById('quickSearch').value.toLowerCase();

            markers.clearLayers();

            allMarkers.forEach(marker => {
                const trip = marker.tripData;
                let show = true;

                if (selectedType && trip.packageType !== selectedType) show = false;
                if (trip.price > maxPrice) show = false;
                if (trip.isOnSale && !showOnSale) show = false;
                if (!trip.isOnSale && !showRegular) show = false;
                if (searchQuery && !trip.name.toLowerCase().includes(searchQuery) && 
                    !trip.destination.toLowerCase().includes(searchQuery) && 
                    !trip.country.toLowerCase().includes(searchQuery)) show = false;

                if (show) markers.addLayer(marker);
            });

            updateStats();
        }

        // Event Listeners
        document.getElementById('mapPackageFilter').addEventListener('change', filterMarkers);
        document.getElementById('mapPriceFilter').addEventListener('input', function() {
            document.getElementById('priceValue').textContent = this.value;
            filterMarkers();
        });
        document.getElementById('showOnSale').addEventListener('change', filterMarkers);
        document.getElementById('showRegular').addEventListener('change', filterMarkers);
        document.getElementById('quickSearch').addEventListener('input', filterMarkers);

        loadMarkers();
    });
</script>