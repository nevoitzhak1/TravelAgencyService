@model TravelAgencyService.Models.ViewModels.ReviewListViewModel
@{
    ViewData["Title"] = "Customer Reviews";
}

<!-- Hero Section -->
<section class="py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="container">
        <div class="row align-items-center text-white">
            <div class="col-lg-8">
                <span class="badge px-4 py-2 mb-3" style="background: rgba(255,255,255,0.2); font-size: 0.9rem; border-radius: 50px;">
                    <i class="bi bi-chat-heart-fill"></i> Testimonials
                </span>
                <h1 class="display-4 fw-bold mb-3">What Our Travelers Say</h1>
                <p class="lead mb-0">Real experiences from real adventures around the world</p>
            </div>
            <div class="col-lg-4 text-center">
                <div class="p-4 rounded" style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px);">
                    <div class="display-3 fw-bold mb-2">@Model.AverageRating</div>
                    <div class="mb-2">
                        @for (int i = 1; i <= 5; i++)
                        {
                            <i class="bi bi-star@(i <= Model.AverageRating ? "-fill" : "") text-warning fs-4"></i>
                        }
                    </div>
                    <small class="opacity-90">Based on @Model.TotalReviews reviews</small>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Filters & Search -->
<section class="py-4 bg-light border-bottom">
    <div class="container">
        <form method="get" asp-action="Index">
            <div class="row g-3 align-items-end">
                <!-- Search -->
                <div class="col-lg-4">
                    <label class="form-label fw-semibold small text-uppercase text-muted">
                        <i class="bi bi-search"></i> Search Reviews
                    </label>
                    <input type="text" name="searchQuery" value="@Model.SearchQuery" 
                           class="form-control form-control-lg" 
                           placeholder="Search by keyword..."
                           style="border-radius: 12px;">
                </div>

                <!-- Rating Filter -->
                <div class="col-lg-3">
                    <label class="form-label fw-semibold small text-uppercase text-muted">
                        <i class="bi bi-star-fill"></i> Rating
                    </label>
                    <select name="rating" class="form-select form-select-lg" style="border-radius: 12px;">
                        <option value="">All Ratings</option>
                        <option value="5" selected="@(Model.SelectedRating == 5)">⭐⭐⭐⭐⭐ 5 Stars</option>
                        <option value="4" selected="@(Model.SelectedRating == 4)">⭐⭐⭐⭐ 4 Stars</option>
                        <option value="3" selected="@(Model.SelectedRating == 3)">⭐⭐⭐ 3 Stars</option>
                        <option value="2" selected="@(Model.SelectedRating == 2)">⭐⭐ 2 Stars</option>
                        <option value="1" selected="@(Model.SelectedRating == 1)">⭐ 1 Star</option>
                    </select>
                </div>

                <!-- Trip Filter -->
                <div class="col-lg-3">
                    <label class="form-label fw-semibold small text-uppercase text-muted">
                        <i class="bi bi-airplane"></i> Destination
                    </label>
                    <select name="tripId" class="form-select form-select-lg" style="border-radius: 12px;">
                        <option value="">All Destinations</option>
                        @foreach (var trip in Model.AvailableTrips)
                        {
                            <option value="@trip.TripId" selected="@(Model.SelectedTripId == trip.TripId)">
                                @trip.PackageName
                            </option>
                        }
                    </select>
                </div>

                <!-- Submit -->
                <div class="col-lg-2">
                    <button type="submit" class="btn btn-lg w-100 fw-bold" 
                            style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; border-radius: 12px;">
                        <i class="bi bi-funnel-fill"></i> Filter
                    </button>
                </div>
            </div>
        </form>
    </div>
</section>

<!-- Rating Statistics -->
<section class="py-4 bg-white">
    <div class="container">
        <div class="row g-3">
            @{
                var total = Model.TotalReviews > 0 ? Model.TotalReviews : 1;
            }
            
            @for (int star = 5; star >= 1; star--)
            {
                var count = star switch
                {
                    5 => Model.FiveStarCount,
                    4 => Model.FourStarCount,
                    3 => Model.ThreeStarCount,
                    2 => Model.TwoStarCount,
                    _ => Model.OneStarCount
                };
                var percentage = (int)Math.Round((double)count / total * 100);

                <div class="col-md">
                    <div class="d-flex align-items-center">
                        <span class="me-2 fw-semibold">@star <i class="bi bi-star-fill text-warning"></i></span>
                        <div class="progress flex-grow-1" style="height: 8px;">
                            <div class="progress-bar" style="width: @percentage%; background: linear-gradient(45deg, #667eea, #764ba2);"></div>
                        </div>
                        <span class="ms-2 small text-muted">@count</span>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- Reviews Grid -->
<section class="py-5">
    <div class="container">
        @if (Model.Reviews.Any())
        {
            <div class="row g-4">
                @foreach (var review in Model.Reviews)
                {
                    <div class="col-lg-4 col-md-6">
                        <div class="card border-0 shadow-sm h-100" style="border-radius: 20px; transition: transform 0.3s ease;">
                            <div class="card-body p-4">
                                <!-- Rating -->
                                <div class="mb-3">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <i class="bi bi-star@(i <= review.Rating ? "-fill" : "") text-warning fs-5"></i>
                                    }
                                </div>

                                <!-- Title -->
                                @if (!string.IsNullOrEmpty(review.Title))
                                {
                                    <h5 class="fw-bold mb-3">"@review.Title"</h5>
                                }

                                <!-- Comment -->
                                <p class="text-muted mb-4">@review.Comment</p>

                                <!-- User Info -->
                                <div class="border-top pt-3">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar me-3" style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(45deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.3rem; font-weight: bold;">
                                            @review.UserName.Substring(0, 1).ToUpper()
                                        </div>
                                        <div>
                                            <div class="fw-bold">@review.UserName</div>
                                            <small class="text-muted">@review.CreatedAt.ToString("MMMM dd, yyyy")</small>
                                            @if (!string.IsNullOrEmpty(review.TripName))
                                            {
                                                <div>
                                                    <small class="text-primary">
                                                        <i class="bi bi-airplane-fill"></i> @review.TripName
                                                    </small>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            @if (Model.TotalPages > 1)
            {
                <nav class="mt-5">
                    <ul class="pagination pagination-lg justify-content-center">
                        <!-- Previous -->
                        <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { page = Model.CurrentPage - 1, rating = Model.SelectedRating, tripId = Model.SelectedTripId, searchQuery = Model.SearchQuery })" 
                               style="border-radius: 12px 0 0 12px;">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>

                        <!-- Page Numbers -->
                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                                <a class="page-link" href="@Url.Action("Index", new { page = i, rating = Model.SelectedRating, tripId = Model.SelectedTripId, searchQuery = Model.SearchQuery })" 
                                   style="@(Model.CurrentPage == i ? "background: linear-gradient(45deg, #667eea, #764ba2); border-color: #667eea;" : "")">
                                    @i
                                </a>
                            </li>
                        }

                        <!-- Next -->
                        <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { page = Model.CurrentPage + 1, rating = Model.SelectedRating, tripId = Model.SelectedTripId, searchQuery = Model.SearchQuery })" 
                               style="border-radius: 0 12px 12px 0;">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            }
        }
        else
        {
            <div class="text-center py-5">
                <i class="bi bi-chat-left-text text-muted" style="font-size: 5rem;"></i>
                <h3 class="mt-4 text-muted">No Reviews Found</h3>
                <p class="text-muted">Try adjusting your filters or search query</p>
            </div>
        }
    </div>
</section>

<!-- CTA -->
<section class="py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="container text-center text-white">
        <h2 class="display-5 fw-bold mb-3">Ready to Create Your Own Story?</h2>
        <p class="lead mb-4">Join thousands of happy travelers exploring the world</p>
        <a asp-controller="Trip" asp-action="Index" class="btn btn-light btn-lg px-5 py-3 fw-bold" style="border-radius: 50px;">
            <i class="bi bi-compass-fill"></i> Explore Destinations
        </a>
    </div>
</section>

<style>
    .card:hover {
        transform: translateY(-8px);
    }
</style>